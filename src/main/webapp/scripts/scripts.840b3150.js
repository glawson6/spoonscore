"use strict";angular.module("clientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","cgBusy"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/busy",{templateUrl:"views/busy-custom.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("clientApp").controller("MainCtrl",["$scope","RestaurantService",function(a,b){function c(){navigator.geolocation?navigator.geolocation.getCurrentPosition(d):alert("Geolocation is not supported by this browser.")}function d(b){a.$apply(function(){a.geometry={latitude:b.coords.latitude,longitude:b.coords.longitude},a.zipFieldNeeded(),a.cityStateZip="",console.log("geometry "+JSON.stringify(a.geometry))})}console.log("MainCtrl is alive!"),a.geometry={latitude:0,longitude:0},a.zipFieldNeeded=function(){return 0===a.geometry.latitude&&0===a.geometry.longitude},a.detectGeometry=function(){c(),a.isCollapsed=!1};var e=function(){var b={};if(a.cityStateZip){if(a.cityStateZip.indexOf(",")>-1){var c=a.cityStateZip.split(",");b.city=_.trim(c[0]),b.state=_.trim(c[1])}else b.zipCode=a.cityStateZip;a.geometry={latitude:0,longitude:0}}else b.latitude=a.geometry.latitude,b.longitude=a.geometry.longitude;return b};a.isCollapsed=!0,a.restaurants=b.lastRestaurants,a.search=function(){console.log("Called search with "+JSON.stringify(a.cityStateZip));var c=e();a.searchPromise=b.findRestaurants(c).success(function(b){a.restaurants=b}).error(function(a){alert("RestaurantSearch ERROR"+a)})},a.next=function(){a.searchPromise=b.nextRestaurants().success(function(b){a.restaurants=b}).error(function(a){alert("RestaurantSearch ERROR"+a)})};var f=function(b){var c=_.findIndex(a.restaurants,function(a){return a.restaurantID===b.restaurantID});console.log("Found "+JSON.stringify(b)+" at "+c),a.restaurants[c]=b};a.exceededTries=function(a){return a.inspectionReportTries?a.inspectionReportTries>=2:!1},a.getInspectionReport=function(c){c.inspectionReportTries=c.inspectionReportTries?c.inspectionReportTries+1:1,a.searchPromise=b.getInspectionReport(c).success(function(a){f(a)}).error(function(a){alert("RestaurantUpdate ERROR"+a)})},a.hasRestaurants=function(){return a.restaurants&&a.restaurants.length>0?!0:!1}}]).directive("drawStarsJs",function(){return{restrict:"A",scope:{options:"="},compile:function(a){var b=function(a,b){var c=b||{};if(c){var d=c.average,e=c.radius,f=new createjs.Stage(a[0]);d=d||0;for(var g=Math.floor(d),h=d-g,i=0;g>i;i++){var j=new createjs.Shape;j.graphics.setStrokeStyle(1).beginStroke("#000000").beginFill("#FBB62B").drawPolyStar(i*e*2+e,e,e,5,.5,-90),f.addChild(j)}if(h>0){var k=new createjs.Shape,l=4*e*(1-h);k.graphics.setStrokeStyle(1).beginStroke("#000000").beginLinearGradientFill(["#FFF","#FBB62B"],[.5,.5],0,0,0,l).drawPolyStar(g*e*2+e,e,e,5,.5,-90),f.addChild(k)}f.update()}};if("CANVAS"!==a[0].tagName)throw new Error("drawStars can only be set on a canvas element. "+a[0].tagName+" will not work.");return function(a,c){a.$watch("options",function(){b(c,a.options)},!0)}}}}),angular.module("clientApp").service("RestaurantService",["$http",function(a){var b=this;b.lastRestaurants=[],b.restaurantSearch={},b.offset=0,console.log("RestaurantService is alive!"),this.findRestaurants=function(c){return b.restaurantSearch=c,console.log("Called RestaurantService.findRestaurants with "+JSON.stringify(c)),a({url:"/api/restaurant/search",method:"POST",data:c}).success(function(a){b.lastRestaurants=a,b.offset=b.offset+b.lastRestaurants.length})},this.nextRestaurants=function(){var c=b.restaurantSearch;return c.offset=b.offset,console.log("Called RestaurantService.nextRestaurants with "+JSON.stringify(c)),a({url:"/api/restaurant/search",method:"POST",data:c}).success(function(a){b.lastRestaurants=a,b.offset=b.offset+b.lastRestaurants.length})},this.getInspectionReport=function(b){return console.log("Called RestaurantService.getInspectionReport with "+JSON.stringify(b)),a({url:"/api/restaurant/inspectionUpdate",method:"POST",data:b})}}]);